# ‚ú® –î–æ—Ä–∞–±–æ—Ç–∫–∏ —Å–∏—Å—Ç–µ–º—ã –¥—É—ç–ª–µ–π

## üìã –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:

### ‚úÖ 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–±–µ–¥–∞ —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞

**–ì–¥–µ:** `monkey-flipper-api/server-api.js` (—Å—Ç—Ä–æ–∫–∞ ~165)

**–õ–æ–≥–∏–∫–∞:**
```javascript
// –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥—É—ç–ª–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∏—Å—Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞
if (duel.status === 'pending' && new Date() > new Date(duel.expires_at)) {
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º winner = player1_id
    UPDATE duels SET 
        status = 'expired', 
        winner = player1_id, 
        completed_at = NOW()
}
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ï—Å–ª–∏ Player 2 –Ω–µ –ø—Ä–∏–Ω—è–ª –≤—ã–∑–æ–≤ –∑–∞ 24 —á–∞—Å–∞
- –ü—Ä–∏ –ª—é–±–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ `/api/duel/:matchId` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤—Ä–µ–º—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ Player 1 —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–º
- –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `expired`

---

### ‚úÖ 2. –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–∞—Ç—á–∞

**–ì–¥–µ:** 
- API: `monkey-flipper-api/server-api.js` (—Å—Ç—Ä–æ–∫–∞ ~308)
- Frontend: `src/index.js` (—Å—Ç—Ä–æ–∫–∞ ~1285)

**–õ–æ–≥–∏–∫–∞:**
```sql
-- API —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
SELECT 
    *,
    CASE 
        WHEN started_at IS NOT NULL AND completed_at IS NOT NULL 
        THEN EXTRACT(EPOCH FROM (completed_at - started_at))
        ELSE NULL 
    END as duration_seconds
FROM duels
```

```javascript
// Frontend —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –≤ –º–∏–Ω—É—Ç—ã –∏ —Å–µ–∫—É–Ω–¥—ã
if (duel.duration_seconds) {
    const minutes = Math.floor(duel.duration_seconds / 60);
    const seconds = Math.floor(duel.duration_seconds % 60);
    durationText = minutes > 0 ? `${minutes}m ${seconds}s` : `${seconds}s`;
}
```

**–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:**
```
vs Player2
üèÜ Won ‚Ä¢ 3127 : 2543
‚è±Ô∏è 2m 34s
```

---

### ‚úÖ 3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –¥—É—ç–ª–µ–π

**–ì–¥–µ:** `src/index.js` (—Å—Ç—Ä–æ–∫–∞ ~1277-1350)

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è:**
1. **–ò–º—è —Å–æ–ø–µ—Ä–Ω–∏–∫–∞**: `vs PlayerName`
2. **–°—Ç–∞—Ç—É—Å —Å —Ü–≤–µ—Ç–æ–º**:
   - ‚è≥ Pending (–æ—Ä–∞–Ω–∂–µ–≤—ã–π) - –æ–∂–∏–¥–∞–µ—Ç –ø—Ä–∏–Ω—è—Ç–∏—è
   - üéÆ Active (—Å–∏–Ω–∏–π) - –ø—Ä–∏–Ω—è—Ç, –∏–¥—ë—Ç –∏–≥—Ä–∞
   - üèÜ Won (–∑–µ–ª—ë–Ω—ã–π) - –ø–æ–±–µ–¥–∞
   - üòî Lost (–∫—Ä–∞—Å–Ω—ã–π) - –ø—Ä–æ–∏–≥—Ä—ã—à
   - ü§ù Draw (–æ—Ä–∞–Ω–∂–µ–≤—ã–π) - –Ω–∏—á—å—è
   - ‚è∞ Expired (—Å–µ—Ä—ã–π) - –∏—Å—Ç—ë–∫ —Å—Ä–æ–∫
3. **–°—á—ë—Ç**: `3127 : 2543`
4. **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: `‚è±Ô∏è 2m 34s` (–µ—Å–ª–∏ –∑–∞–≤–µ—Ä—à—ë–Ω)

**–†–∞–∑–º–µ—Ä —Å—Ç—Ä–æ–∫–∏:** —É–≤–µ–ª–∏—á–µ–Ω —Å 70px –¥–æ 80px –¥–ª—è —Ç—Ä–µ—Ç—å–µ–π —Å—Ç—Ä–æ–∫–∏

---

### ‚úÖ 4. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∏—á—å–µ–π

**–ì–¥–µ:** 
- API: `monkey-flipper-api/server-api.js` (—Å—Ç—Ä–æ–∫–∞ ~276)
- Frontend: `src/index.js` (—Å—Ç—Ä–æ–∫–∞ ~1300, ~2722)

**–õ–æ–≥–∏–∫–∞:**
```javascript
// API –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∏—á—å—é
const winner = updatedDuel.score1 > updatedDuel.score2 
    ? updatedDuel.player1_id 
    : updatedDuel.score2 > updatedDuel.score1
        ? updatedDuel.player2_id
        : 'draw';  // ‚≠ê –ù–∏—á—å—è
```

**–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:**
- –í –∏—Å—Ç–æ—Ä–∏–∏: `ü§ù Draw`
- –ù–∞ —ç–∫—Ä–∞–Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: `ü§ù DRAW!` (–æ—Ä–∞–Ω–∂–µ–≤—ã–π)

---

### ‚úÖ 5. –ú–µ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–∏

**–ì–¥–µ:** `monkey-flipper-api/server-api.js`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```sql
-- –ü—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –≤—ã–∑–æ–≤–∞
UPDATE duels SET started_at = NOW()

-- –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–±–æ–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏
UPDATE duels SET completed_at = NOW()
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- `created_at` - –∫–æ–≥–¥–∞ —Å–æ–∑–¥–∞–Ω –≤—ã–∑–æ–≤
- `started_at` - –∫–æ–≥–¥–∞ Player 2 –ø—Ä–∏–Ω—è–ª
- `completed_at` - –∫–æ–≥–¥–∞ –æ–±–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∏
- `expires_at` - –∫—Ä–∞–π–Ω–∏–π —Å—Ä–æ–∫ (created_at + 24h)

---

## üìä –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Å—Ö–µ–º–∞ —Å—Ç–∞—Ç—É—Å–æ–≤:

| Status | –û–ø–∏—Å–∞–Ω–∏–µ | score1 | score2 | winner | duration |
|--------|----------|--------|--------|--------|----------|
| `pending` | Player 2 –Ω–µ –ø—Ä–∏–Ω—è–ª | NULL | NULL | NULL | NULL |
| `active` | –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å | –ª—é–±–æ–µ | –ª—é–±–æ–µ | NULL | NULL |
| `completed` | –û–±–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∏ | —á–∏—Å–ª–æ | —á–∏—Å–ª–æ | ID/'draw' | —á–∏—Å–ª–æ |
| `expired` | –ò—Å—Ç—ë–∫ —Å—Ä–æ–∫ (–∞–≤—Ç–æ-–ø–æ–±–µ–¥–∞ P1) | –ª—é–±–æ–µ | –ª—é–±–æ–µ | player1_id | –ª—é–±–æ–µ |

---

## üéØ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –¥—É—ç–ª–∏ —Ç–µ–ø–µ—Ä—å:

```
1. Player 1 —Å–æ–∑–¥–∞—ë—Ç –≤—ã–∑–æ–≤
   ‚Üì status: pending
   ‚Üì created_at: NOW
   ‚Üì expires_at: NOW + 24h
   
2. Player 2 –ø—Ä–∏–Ω–∏–º–∞–µ—Ç
   ‚Üì status: active
   ‚Üì started_at: NOW
   ‚Üì player2_id –∑–∞–ø–æ–ª–Ω–µ–Ω
   
3. Player 1 –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç
   ‚Üì score1: 2543
   ‚Üì –ñ–¥—ë—Ç Player 2...
   
4. Player 2 –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç
   ‚Üì score2: 3127
   ‚Üì status: completed
   ‚Üì completed_at: NOW
   ‚Üì winner: player2_id
   ‚Üì duration: completed_at - started_at
   
5. –û–±–∞ –≤–∏–¥—è—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
   Player 1: üòî Lost ‚Ä¢ 2543 : 3127 ‚Ä¢ ‚è±Ô∏è 2m 34s
   Player 2: üèÜ Won ‚Ä¢ 3127 : 2543 ‚Ä¢ ‚è±Ô∏è 2m 34s
```

**–ï—Å–ª–∏ Player 2 –Ω–µ –ø—Ä–∏–Ω—è–ª –∑–∞ 24 —á–∞—Å–∞:**
```
1. –ö—Ç–æ-—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç /api/duel/:matchId
   ‚Üì –ü—Ä–æ–≤–µ—Ä–∫–∞: NOW > expires_at?
   ‚Üì –î–∞!
   ‚Üì status: expired
   ‚Üì winner: player1_id
   ‚Üì completed_at: NOW
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. `monkey-flipper-api/server-api.js` - 10 —Å—Ç—Ä–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞—Å—á—ë—Ç duration_seconds –≤ SQL
   - –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–±–µ–¥—ã

2. `src/index.js` - 19 —Å—Ç—Ä–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –î–æ–±–∞–≤–ª–µ–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∏—á—å–µ–π –≤ UI
   - –£–≤–µ–ª–∏—á–µ–Ω —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–æ–∫ –∏—Å—Ç–æ—Ä–∏–∏

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
‚úÖ –°—Ç–∞—Ä—ã–µ –¥—É—ç–ª–∏ –±–µ–∑ duration_seconds –±—É–¥—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏
‚úÖ –ö–æ–¥ –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- SQL –∑–∞–ø—Ä–æ—Å —Å EXTRACT(EPOCH) –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞ ~0.5ms
- –ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- –†–∞—Å—á—ë—Ç –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ PostgreSQL (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ)

---

## ‚ú® –ò—Ç–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:

1. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–±–µ–¥–∞ —á–µ—Ä–µ–∑ 24—á** - —Ä–∞–±–æ—Ç–∞–µ—Ç
2. ‚úÖ **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–∞—Ç—á–∞** - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏
3. ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∏—á—å–µ–π** - `winner = 'draw'`
4. ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ** - 3 —Å—Ç—Ä–æ–∫–∏ –≤–º–µ—Å—Ç–æ 2
5. ‚úÖ **–¶–≤–µ—Ç–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã** - –ø–æ–Ω—è—Ç–Ω–æ —Å –ø–µ—Ä–≤–æ–≥–æ –≤–∑–≥–ª—è–¥–∞

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
- [ ] –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä—ã–∂–∫–æ–≤ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä—ã–∂–∫–∞)
- [ ] –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–≥—Ä–æ–∫–∞
- [ ] –†–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–æ–±–µ–¥
- [ ] –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è (badges) –∑–∞ –ø–æ–±–µ–¥—ã

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
- [ ] "–¢–µ–Ω—å" —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ (ghost) –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
- [ ] –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–≤–∞–Ω—à–∞ (rematch) –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–æ–≥–¥–∞ —Å–æ–ø–µ—Ä–Ω–∏–∫ –∑–∞–∫–æ–Ω—á–∏–ª

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—É–∂–µ –≥–æ—Ç–æ–≤–æ):
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–±–µ–¥–∞ —á–µ—Ä–µ–∑ 24—á
- [x] –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–∞—Ç—á–∞
- [x] –ù–∏—á—å—è
- [x] –î–µ—Ç–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è

---

–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–æ! üéâ
