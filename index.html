<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <title>Monkey Flipper</title>
    
    <!-- –ù–û–í–û–ï: Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- –ù–û–í–û–ï: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App -->
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram Web App —Å—Ä–∞–∑—É
        if (window.Telegram && window.Telegram.WebApp) {
            const tg = window.Telegram.WebApp;
            
            // –í–ê–ñ–ù–û: –°–Ω–∞—á–∞–ª–∞ —Ä–∞—Å—à–∏—Ä—è–µ–º –æ–∫–Ω–æ
            tg.expand();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞
            tg.setHeaderColor('#000000');
            tg.setBackgroundColor('#000000');
            
            // –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
            tg.ready();
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å–≤–∞–π–ø—ã (—á—Ç–æ–±—ã –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª–æ—Å—å)
            tg.enableClosingConfirmation();
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥" –µ—Å–ª–∏ –µ—Å—Ç—å
            if (tg.BackButton) {
                tg.BackButton.hide();
            }
            
            console.log('‚úÖ Telegram Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:', tg.initDataUnsafe);
            console.log('üì± Viewport height:', tg.viewportHeight, 'Window height:', window.innerHeight);
            
            // –§–ò–ö–°: –ü—Ä–æ—Å—Ç–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∫—Ä–æ–ª–ª–∞ –¥–ª—è Telegram
            window.addEventListener('load', function() {
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä–æ–ª–ª–∏–º –Ω–∞–≤–µ—Ä—Ö
                window.scrollTo(0, 0);
                
                // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å–∫—Ä–æ–ª–ª
                document.addEventListener('touchmove', function(e) {
                    if (e.target.tagName !== 'CANVAS') {
                        e.preventDefault();
                    }
                }, { passive: false });
                
                console.log('üîí –°–∫—Ä–æ–ª–ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');
            });
        } else {
            console.warn('‚ö†Ô∏è Telegram Web App SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
        }
    </script>
    
    <!-- Socket.IO Client for 1v1 multiplayer -->
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.90.0/dist/phaser.js"></script>
    <!-- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: minified –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.90.0/dist/phaser.min.js"></script>
    -->
    <script src="./src/index.js"></script>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
            position: fixed; /* –§–ò–ö–°: –§–∏–∫—Å–∏—Ä—É–µ–º —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Å–∫—Ä–æ–ª–ª–∞ –≤ TG */
        }
        
        body {
            touch-action: none; /* –§–ò–ö–°: –ü–æ–ª–Ω–æ—Å—Ç—å—é –±–ª–æ–∫–∏—Ä—É–µ–º touch –∂–µ—Å—Ç—ã */
        }
        
        #game-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            overflow: hidden;
        }
        
        /* –§–ò–ö–°: Canvas –∑–∞–ø–æ–ª–Ω—è–µ—Ç –º–∞–∫—Å–∏–º—É–º –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ */
        canvas {
            display: block;
            background: #000;
            max-width: 100%;
            max-height: 100%;
            width: auto !important;
            height: auto !important;
        }
        
        /* üé¨ INTRO VIDEO STYLES */
        #intro-video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        #intro-video-overlay.hidden {
            display: none;
        }
        
        #intro-video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        #skip-intro-hint {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.8);
            font-family: Arial, sans-serif;
            font-size: 14px;
            text-align: center;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- üé¨ INTRO VIDEO OVERLAY -->
    <div id="intro-video-overlay">
        <video id="intro-video" playsinline muted preload="auto" autoplay>
            <source src="./assets/intro.mp4" type="video/mp4">
            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ
        </video>
        <div id="skip-intro-hint">üëÜ –ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å</div>
    </div>
    
    <div id="game-container"></div>
    
    <script>
        // üé¨ INTRO VIDEO LOGIC
        (function() {
            const overlay = document.getElementById('intro-video-overlay');
            const video = document.getElementById('intro-video');
            let videoStarted = false;
            
            console.log('üé¨ Intro video –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è');
            console.log('üìç Video src:', video.querySelector('source')?.src);
            
            function hideIntro() {
                if (overlay.classList.contains('hidden')) return; // –£–∂–µ —Å–∫—Ä—ã—Ç–æ
                overlay.classList.add('hidden');
                video.pause();
                video.removeAttribute('src');
                video.load(); // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å
                console.log('üéÆ Intro –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã');
            }
            
            // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø–æ –∫–ª–∏–∫—É/—Ç–∞–ø—É
            function skipIntro(e) {
                e.preventDefault();
                console.log('üëÜ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–ø—É—Å—Ç–∏–ª intro');
                hideIntro();
            }
            
            overlay.addEventListener('click', skipIntro);
            overlay.addEventListener('touchend', skipIntro, { passive: false });
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤–∏–¥–µ–æ
            video.addEventListener('ended', function() {
                console.log('üèÅ –í–∏–¥–µ–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å');
                hideIntro();
            });
            
            // –ï—Å–ª–∏ –≤–∏–¥–µ–æ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å - —Å—Ä–∞–∑—É –∫ –∏–≥—Ä–µ
            video.addEventListener('error', function(e) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ:', e.target?.error?.message || 'unknown');
                hideIntro();
            });
            
            // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏
            video.addEventListener('loadstart', function() {
                console.log('üì• –ù–∞—á–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ');
            });
            
            video.addEventListener('canplay', function() {
                console.log('‚úÖ –í–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é');
                tryPlayVideo();
            });
            
            // –§–ò–ö–°: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤–∏–¥–µ–æ
            function tryPlayVideo() {
                if (videoStarted) return;
                console.log('‚ñ∂Ô∏è –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏–¥–µ–æ...');
                
                const playPromise = video.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(function() {
                        videoStarted = true;
                        console.log('‚úÖ –í–∏–¥–µ–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è!');
                    }).catch(function(error) {
                        console.warn('‚ö†Ô∏è –ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', error.name, error.message);
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É —á—Ç–æ –Ω—É–∂–µ–Ω —Ç–∞–ø
                        document.getElementById('skip-intro-hint').textContent = 'üëÜ –ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å';
                    });
                }
            }
            
            // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            video.addEventListener('loadeddata', function() {
                console.log('üìº –î–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                tryPlayVideo();
            });
            
            // –¢–∞–π–º–∞—É—Ç –Ω–∞ —Å–ª—É—á–∞–π –∑–∞–≤–∏—Å–∞–Ω–∏—è (—É–º–µ–Ω—å—à–µ–Ω –¥–æ 3 —Å–µ–∫ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏)
            setTimeout(function() {
                if (!overlay.classList.contains('hidden')) {
                    console.log('‚è±Ô∏è –¢–∞–π–º–∞—É—Ç intro video (3 —Å–µ–∫)');
                    hideIntro();
                }
            }, 3000);
            
            // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å–∫–∞
            setTimeout(tryPlayVideo, 100);
            
            // –§–ò–ö–°: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - –µ—Å–ª–∏ —á–µ—Ä–µ–∑ 1 —Å–µ–∫ –≤–∏–¥–µ–æ –Ω–µ –∏–≥—Ä–∞–µ—Ç, —Å–∫—Ä—ã–≤–∞–µ–º
            setTimeout(function() {
                if (!videoStarted && !overlay.classList.contains('hidden')) {
                    console.log('‚ö†Ô∏è –í–∏–¥–µ–æ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å –∑–∞ 1 —Å–µ–∫, —Å–∫—Ä—ã–≤–∞–µ–º intro');
                    hideIntro();
                }
            }, 1000);
        })();
    </script>
</body>
</html>