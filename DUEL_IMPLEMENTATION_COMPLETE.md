# ‚úÖ –î—É—ç–ª–∏ - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞

## üéØ –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### **Backend (server-api.js)**

#### 1. **–†–∞—Å—à–∏—Ä–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã `duels`**
–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π –∏–≥—Ä–æ–∫–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
- `player1_x`, `player1_y` - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
- `player2_x`, `player2_y` - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞
- `player1_alive`, `player2_alive` - —Å—Ç–∞—Ç—É—Å –∂–∏–∑–Ω–∏
- `player1_last_update`, `player2_last_update` - –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### 2. **–ù–æ–≤—ã–µ API endpoints**

**POST `/api/duel/:matchId/position`**
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞ –≤ –¥—É—ç–ª–∏
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `playerId`, `x`, `y`, `score`, `isAlive`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–∑–∏—Ü–∏–π –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏

**GET `/api/duel/:matchId/opponent/:playerId`**
- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –ø–æ–∑–∏—Ü–∏—é, —Å—á–µ—Ç, —Å—Ç–∞—Ç—É—Å –∂–∏–∑–Ω–∏, —Ñ–ª–∞–≥ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è "—Ç–µ–Ω–∏" —Å–æ–ø–µ—Ä–Ω–∏–∫–∞

#### 3. **–§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –∞–≤—Ç–æ–∞–Ω–Ω—É–ª—è—Ü–∏–∏**
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —á–∞—Å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–Ω—É–ª–∏—Ä—É–µ—Ç –¥—É—ç–ª–∏ —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤
- –ü–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

---

### **Frontend (src/index.js)**

#### 1. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è "—Ç–µ–Ω–∏" —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –≤ duel mode**

–í `GameScene.createPlayer()`:
- –°–æ–∑–¥–∞–Ω–∏–µ ghost –¥–ª—è —Ä–µ–∂–∏–º–∞ duel
- –ù–µ–∞–∫—Ç–∏–≤–Ω–∞—è —Ç–µ–Ω—å (—Å–µ—Ä–∞—è, –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è) –ø–æ–∫–∞ —Å–æ–ø–µ—Ä–Ω–∏–∫ –Ω–µ –Ω–∞—á–∞–ª
- –ê–∫—Ç–∏–≤–Ω–∞—è —Ç–µ–Ω—å (–∫—Ä–∞—Å–Ω–æ–≤–∞—Ç–∞—è) –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–º

#### 2. **Polling –ø–æ–∑–∏—Ü–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**

–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:
- `startDuelPolling()` - –∑–∞–ø—É—Å–∫ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–∫–∞–∂–¥—ã–µ 500ms)
- `updateDuelOpponent()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª–∞ ghost –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞

–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
1. –ö–∞–∂–¥—ã–µ 500ms –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ—é –ø–æ–∑–∏—Ü–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä
2. –ü–æ–ª—É—á–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
3. –û–±–Ω–æ–≤–ª—è–µ—Ç ghost –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π

#### 3. **–£–º–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞**

- **–ù–µ –Ω–∞—á–∞–ª**: —Ç–µ–Ω—å —Ç–µ–º–Ω–æ-—Å–µ—Ä–∞—è (0.2 alpha), —Å—Ç–æ–∏—Ç –Ω–∞ –º–µ—Å—Ç–µ
- **–ò–≥—Ä–∞–µ—Ç**: —Ç–µ–Ω—å –∫—Ä–∞—Å–Ω–æ–≤–∞—Ç–∞—è (0.6 alpha), –¥–≤–∏–∂–µ—Ç—Å—è
- **–ü–æ–≥–∏–±**: —Ç–µ–Ω—å —Å–µ—Ä–∞—è (0.3 alpha), –∑–∞–º–∏—Ä–∞–µ—Ç –Ω–∞ –º–µ—Å—Ç–µ —Å–º–µ—Ä—Ç–∏

#### 4. **–£–ª—É—á—à–µ–Ω shareDialog —Å Telegram WebApp API**

–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `switchInlineQuery()` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —á–∞—Ç
- Fallback –Ω–∞ `openTelegramLink()` –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π
- –ü–æ–∫–∞–∑ popup-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–º–µ–Ω–µ–º –∏–≥—Ä–æ–∫–∞

#### 5. **–û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤**

–í `completeDuel()`:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ polling –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏–≥—Ä—ã
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏

---

## üéÆ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### **–°—Ü–µ–Ω–∞—Ä–∏–π 1: –°–æ–∑–¥–∞—Ç–µ–ª—å –¥—É—ç–ª–∏ (Player 1)**

1. –ù–∞–∂–∏–º–∞–µ—Ç "Challenge Friend"
2. –ò–≥—Ä–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ API
3. –í–∏–¥–∏—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω—É—é —Ç–µ–Ω—å —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ (—Å–µ—Ä—É—é)
4. –ù–∞—á–∏–Ω–∞–µ—Ç –∏–≥—Ä–∞—Ç—å
5. –ï–≥–æ –ø–æ–∑–∏—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 500ms
6. –ö–æ–≥–¥–∞ Player 2 –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è - —Ç–µ–Ω—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π

### **–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä–∏–Ω–∏–º–∞—é—â–∏–π –≤—ã–∑–æ–≤ (Player 2)**

1. –ü–æ–ª—É—á–∞–µ—Ç —Å—Å—ã–ª–∫—É/Match ID
2. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ API
3. –í–∏–¥–∏—Ç –∞–∫—Ç–∏–≤–Ω—É—é —Ç–µ–Ω—å Player 1 (–æ–Ω —É–∂–µ –∏–≥—Ä–∞–µ—Ç)
4. –ù–∞—á–∏–Ω–∞–µ—Ç –∏–≥—Ä–∞—Ç—å, –≤–∏–¥—è –¥–≤–∏–∂–µ–Ω–∏—è –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### **–°—Ü–µ–Ω–∞—Ä–∏–π 3: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ**

1. –ò–≥—Ä–æ–∫ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `completeDuel()`
2. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è polling –ø–æ–∑–∏—Ü–∏–π
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—á–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
4. –ï—Å–ª–∏ –æ–±–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç
5. –ï—Å–ª–∏ –æ–¥–∏–Ω –∂–¥–µ—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —ç–∫—Ä–∞–Ω –æ–∂–∏–¥–∞–Ω–∏—è —Å polling —Å—Ç–∞—Ç—É—Å–∞

---

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π**

```
Player 1                    Server                    Player 2
   |                          |                          |
   |--POST /position--------->|                          |
   |                          |<------GET /opponent------|
   |                          |------------------------->|
   |                          |                          |
   |--POST /position--------->|                          |
   |                          |<------GET /opponent------|
   |                          |------------------------->|
```

### **–ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π**
- –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏: –∫–∞–∂–¥—ã–µ 500ms
- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏: –∫–∞–∂–¥—ã–µ 500ms
- –ü–ª–∞–≤–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏: 400ms tween

### **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**
- –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ POST –∏ GET –≤ –æ–¥–Ω–æ–º —Ü–∏–∫–ª–µ
- –û—Å—Ç–∞–Ω–æ–≤–∫–∞ polling –ø—Ä–∏ game over
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞

---

## ‚ú® –ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é

‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –≤—ã–∑–æ–≤–∞ –Ω–∞ –¥—É—ç–ª—å  
‚úÖ –ü—Ä–∏–Ω—è—Ç–∏–µ –≤—ã–∑–æ–≤–∞  
‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ "—Ç–µ–Ω–∏" —Å–æ–ø–µ—Ä–Ω–∏–∫–∞  
‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏  
‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞ (–Ω–µ –Ω–∞—á–∞–ª/–∏–≥—Ä–∞–µ—Ç/–ø–æ–≥–∏–±)  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–Ω–Ω—É–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞  
‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è  
‚úÖ –ò—Å—Ç–æ—Ä–∏—è –¥—É—ç–ª–µ–π  
‚úÖ –£–¥–æ–±–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤—ã–∑–æ–≤–∞ —á–µ—Ä–µ–∑ Telegram  

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–∂–∏–º–∞ –¥—É—ç–ª–µ–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
2. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ Render
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Telegram Mini App
4. –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –æ—Ç –∏–≥—Ä–æ–∫–æ–≤
