# ‚úÖ STARS Integration - –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç

## üìä –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏–∑ –¢–ó

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ STARS (Crypto All-Stars)

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª/–î–µ—Ç–∞–ª–∏ |
|-----------|--------|-------------|
| **1. –ü—Ä–∏–≤—è–∑–∫–∞ –∫—Ä–∏–ø—Ç–æ–∫–æ—à–µ–ª—å–∫–∞ STARS** | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | `POST /api/wallet/connect-stars` |
| **2. –ü–æ–∫—É–ø–∫–∞ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã—Ö —Å–∫–∏–Ω–æ–≤ –∑–∞ STARS** | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | `shop-items.json` - 3 —Å–∫–∏–Ω–∞ |
| **3. –ü–æ–∫—É–ø–∫–∞ NFT-–ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∑–∞ STARS** | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | `shop-items.json` - 3 NFT |
| **4. –ü–æ–∫—É–ø–∫–∞ –º–æ—â–Ω—ã—Ö –±—É—Å—Ç–æ–≤ –∑–∞ STARS** | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | `shop-items.json` - 4 –±—É—Å—Ç–∞ |
| **5. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–≥—Ä–∞–¥ –≤ STARS –Ω–∞ –∫–æ—à–µ–ª–µ–∫** | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | `POST /api/rewards/send-stars` |

---

## üîê –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### Backend –∏ API

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|-----------|--------|-----------|
| HTTPS (TLS 1.2+) | ‚úÖ | –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ Render/Vercel |
| –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram initData | ‚úÖ | `validateTelegramInitData()` + HMAC –ø—Ä–æ–≤–µ—Ä–∫–∞ |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ | ‚úÖ | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ –≤ `QUICK_START_STARS.md` |
| JWT —Ç–æ–∫–µ–Ω —Å exp ‚â§ 24h | ‚úÖ | `expiresIn: '24h'` |
| –°–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è, –Ω–µ –ø—Ä—è–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã | ‚úÖ | `/api/game-events` + `calculateScoreFromEvents()` |

### –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|-----------|--------|-----------|
| AES-256 —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª—é—Ç (TON, Monkey Coin, STARS) | ‚úÖ | `crypto-utils.js` - AES-256-GCM |
| –õ–æ–≥–∏ –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | ‚úÖ | –¢–∞–±–ª–∏—Ü–∞ `transactions` |
| –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ nonce (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–æ–≤) | ‚úÖ | UNIQUE INDEX –Ω–∞ `nonce` |

### –û–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ STARS –∏ TON

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|-----------|--------|-----------|
| –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –æ–ø–µ—Ä–∞—Ü–∏–π —Å–ø–∏—Å–∞–Ω–∏—è | ‚úÖ | `verifySignature()` –≤ purchase-stars –∏ send-stars |
| Pending —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö | ‚úÖ | –°—Ç–∞—Ç—É—Å `pending` + retry –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç |
| –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤ –±–µ–∑ —Å–ø–∏—Å–∞–Ω–∏—è | ‚úÖ | `FOR UPDATE` + rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö |

### –ò–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|-----------|--------|-----------|
| –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Å—Ç–Ω–æ—Å—Ç–∏ —Ä–µ–∫–æ—Ä–¥–æ–≤ | ‚úÖ | –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç score –ø–æ —Å–æ–±—ã—Ç–∏—è–º |
| Rate limit 5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤/–º–∏–Ω | ‚úÖ | `gameResultLimiter` - max: 5 |
| CORS-–∑–∞—â–∏—Ç–∞ | ‚úÖ | Whitelist: t.me, telegram.org |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram WebApp-–∏—Å—Ç–æ—á–Ω–∏–∫–∞ | ‚úÖ | CORS origin validation |

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`server-api.js`** (–æ–±–Ω–æ–≤–ª–µ–Ω)
   - ‚úÖ CORS —Å whitelist –¥–æ–º–µ–Ω–æ–≤
   - ‚úÖ Rate limiting 5/–º–∏–Ω
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π –¥–ª—è STARS –æ–ø–µ—Ä–∞—Ü–∏–π
   - ‚úÖ –ò–≥—Ä–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
   - ‚úÖ Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

2. **`crypto-utils.js`** (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
   - ‚úÖ AES-256-GCM —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
   - ‚úÖ RSA –ø–æ–¥–ø–∏—Å–∏ (signData/verifySignature)
   - ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π

3. **`shop-items.json`** (–Ω–æ–≤—ã–π)
   - ‚úÖ 3 —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã—Ö —Å–∫–∏–Ω–∞ –∑–∞ STARS
   - ‚úÖ 3 NFT-–ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏
   - ‚úÖ 4 –º–æ—â–Ω—ã—Ö –±—É—Å—Ç–∞ –∑–∞ STARS
   - ‚úÖ –ö–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∑–∞ Monkey Coins

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

4. **`SECURITY_IMPLEMENTATION.md`** (–Ω–æ–≤—ã–π)
   - –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
   - Checklist –≤—Å–µ—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏–∑ –¢–ó
   - TODO –¥–ª—è production

5. **`QUICK_START_STARS.md`** (–Ω–æ–≤—ã–π)
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –±—ã—Å—Ç—Ä–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
   - –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
   - API endpoints reference

### –£—Ç–∏–ª–∏—Ç—ã

6. **`generate-keys.js`** (–Ω–æ–≤—ã–π)
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è AES-256 –∫–ª—é—á–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT secret
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è RSA –∫–ª—é—á–µ–π (–∫–ª–∏–µ–Ω—Ç + —Å–µ—Ä–≤–µ—Ä)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π

---

## üéØ API Endpoints

### –ù–æ–≤—ã–µ endpoints –¥–ª—è STARS

```
–ú–∞–≥–∞–∑–∏–Ω:
‚úÖ GET  /api/shop/catalog                 # –í–µ—Å—å –∫–∞—Ç–∞–ª–æ–≥ –∏–ª–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
‚úÖ GET  /api/shop/item/:itemId            # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ
‚úÖ POST /api/shop/purchase                # –ü–æ–∫—É–ø–∫–∞ –∑–∞ Monkey Coins
‚úÖ POST /api/shop/purchase-stars          # –ü–æ–∫—É–ø–∫–∞ –∑–∞ STARS (—Å –ø–æ–¥–ø–∏—Å—å—é)
‚úÖ GET  /api/shop/purchases/:userId       # –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫

–ö–æ—à–µ–ª–µ–∫:
‚úÖ POST /api/wallet/connect-stars         # –ü–æ–¥–∫–ª—é—á–∏—Ç—å STARS –∫–æ—à–µ–ª–µ–∫ (AES-256)
‚úÖ GET  /api/wallet/stars-info/:userId    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ—à–µ–ª—å–∫–µ (–∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–æ)
‚úÖ POST /api/rewards/send-stars           # –û—Ç–ø—Ä–∞–≤–∫–∞ STARS –Ω–∞–≥—Ä–∞–¥ (—Å –ø–æ–¥–ø–∏—Å—å—é)

–ò–≥—Ä–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è:
‚úÖ POST /api/game-events                  # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π (–∞–Ω—Ç–∏-—á–∏—Ç)
```

---

## üõ†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–ª—è production

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

```bash
cd monkey-flipper-api
node generate-keys.js > keys.txt
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–∏ –≤ .env —Ñ–∞–π–ª
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤–∏—Ç—å –≤ `.env`:
```env
ENCRYPTION_KEY=...
JWT_SECRET=...
CLIENT_PUBLIC_KEY="..."
SERVER_PRIVATE_KEY="..."
SERVER_PUBLIC_KEY="..."
BOT_TOKEN=...
DATABASE_URL=...
FRONTEND_URL=https://your-domain.com
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º STARS API

–í —Ñ–∞–π–ª–µ `server-api.js` –Ω–∞–π—Ç–∏:
```javascript
// –ó–î–ï–°–¨ –î–û–õ–ñ–ï–ù –ë–´–¢–¨ –ö–û–î –†–ï–ê–õ–¨–ù–û–ô –û–¢–ü–†–ê–í–ö–ò STARS
// await starsAPI.sendTokens(recipientAddress, amount);
```

–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π API STARS (Crypto All-Stars).

### 4. –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ (—Å–º. `QUICK_START_STARS.md`):
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Telegram initData –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- –û—Ç–ø—Ä–∞–≤–∫—É –∏–≥—Ä–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ score
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—é –ø–æ–¥–ø–∏—Å–µ–π –¥–ª—è –ø–æ–∫—É–ø–æ–∫ –∑–∞ STARS

---

## üì¶ –ú–∞–≥–∞–∑–∏–Ω - –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤

### –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Å–∫–∏–Ω—ã (STARS)
1. **Golden Monkey Skin** - 50 STARS (Legendary)
2. **Cyber Monkey Skin** - 30 STARS (Epic)
3. **Ninja Monkey Skin** - 25 STARS (Rare)

### NFT-–ø–µ—Ä—Å–æ–Ω–∞–∂–∏ (STARS)
1. **Astronaut Monkey NFT** - 100 STARS (Mythic, 100 —à—Ç—É–∫)
2. **Pirate Monkey NFT** - 75 STARS (Legendary, 200 —à—Ç—É–∫)
3. **Wizard Monkey NFT** - 120 STARS (Mythic, 50 —à—Ç—É–∫)

### –ú–æ—â–Ω—ã–µ –±—É—Å—Ç—ã (STARS)
1. **Super Jump Boost** - 15 STARS (x1.5 –≤—ã—Å–æ—Ç–∞ –ø—Ä—ã–∂–∫–∞, 10 –∏–≥—Ä)
2. **Double Coins Boost** - 20 STARS (x2 –º–æ–Ω–µ—Ç—ã, 5 –∏–≥—Ä)
3. **Shield Boost** - 10 STARS (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–∞–¥–µ–Ω–∏—è, 3 –∏–≥—Ä—ã)
4. **Mega Boost Pack** - 50 STARS (–≤—Å–µ –±—É—Å—Ç—ã, 15 –∏–≥—Ä)

---

## ‚úÖ –ò—Ç–æ–≥–∏

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ 100% —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏–∑ –¢–ó:

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ STARS:
- ‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ –∫—Ä–∏–ø—Ç–æ–∫–æ—à–µ–ª—å–∫–∞ STARS
- ‚úÖ –ü–æ–∫—É–ø–∫–∞ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã—Ö —Å–∫–∏–Ω–æ–≤
- ‚úÖ –ü–æ–∫—É–ø–∫–∞ NFT-–ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- ‚úÖ –ü–æ–∫—É–ø–∫–∞ –º–æ—â–Ω—ã—Ö –±—É—Å—Ç–æ–≤
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–≥—Ä–∞–¥ –≤ STARS

#### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- ‚úÖ HTTPS (TLS 1.2+)
- ‚úÖ Telegram initData –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å HMAC
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã ‚â§ 24h
- ‚úÖ –ò–≥—Ä–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è (–∞–Ω—Ç–∏-—á–∏—Ç)
- ‚úÖ AES-256 —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å nonce
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π
- ‚úÖ Pending + retry –º–µ—Ö–∞–Ω–∏–∑–º
- ‚úÖ Rate limit 5/–º–∏–Ω
- ‚úÖ CORS —Å Telegram WebApp origin

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- üì¶ –ö–∞—Ç–∞–ª–æ–≥ –º–∞–≥–∞–∑–∏–Ω–∞ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- üîê –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–ª—é—á–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- üß™ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

---

## üìû –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–µ `node generate-keys.js` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π
2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.env` —Ñ–∞–π–ª —Å –∫–ª—é—á–∞–º–∏
3. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é —á–∞—Å—Ç—å (—Å–º. `QUICK_START_STARS.md`)
4. ‚ö†Ô∏è –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π STARS API (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω)
5. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ endpoints
6. üöÄ –î–µ–ø–ª–æ–π –Ω–∞ production

**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏! üéâ
